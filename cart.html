<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cart</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="max-w-xl mx-auto py-8">
    <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">Keranjang</h1>
    <div id="cart" class="space-y-4 mb-6"></div>

    <div class="flex justify-end mb-4">
      <button id="clear-cart"
        class="bg-red-500 text-white px-4 py-2 rounded shadow hover:bg-red-600 transition font-semibold">
        Hapus Semua Pesanan
      </button>
    </div>

    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <label class="block mb-4 text-gray-700 font-medium">
        Nomor Meja:
        <input type="text" id="meja" class="mt-1 block w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Masukkan nomor meja">
      </label>
      <label class="block mb-4 text-gray-700 font-medium">
        Pilih Pembayaran:
        <select id="metode" class="mt-1 block w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
          <option value="cash">Bayar di Kasir</option>
          <option value="qris">QRIS</option>
        </select>
      </label>
      <button onclick="kirimPesanan()"
        class="w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition font-semibold shadow mt-2">
        Kirim Pesanan
      </button>
    </div>
    <div class="flex justify-center">
      <a href="index.html" class="text-blue-600 hover:underline">Kembali ke Menu</a>
    </div>
  </div>

  <script>
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    const container = document.getElementById("cart");

    function renderCart() {
      container.innerHTML = "";
      if (cart.length === 0) {
        container.innerHTML = `<div class="text-center text-gray-500">Keranjang kosong.</div>`;
        document.getElementById("clear-cart").style.display = "none";
        return;
      }
      document.getElementById("clear-cart").style.display = "inline-block";
      cart.forEach((item, idx) => {
        const div = document.createElement("div");
        div.className = "bg-white rounded shadow p-4 flex justify-between items-center";
        div.innerHTML = `
          <div>
            <span class="font-medium text-gray-700">${item.name}</span>
            <span class="text-gray-500 ml-2">Rp${item.price}</span>
          </div>
          <button onclick="removeItem(${idx})"
            class="ml-4 bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition text-sm">
            Hapus
          </button>
        `;
        container.appendChild(div);
      });
    }

    function removeItem(idx) {
      cart.splice(idx, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    document.getElementById("clear-cart").onclick = function() {
      if (confirm("Hapus semua pesanan dari keranjang?")) {
        cart = [];
        localStorage.removeItem("cart");
        renderCart();
      }
    };

    renderCart();

    async function kirimPesanan() {
      const meja = document.getElementById("meja").value;
      const metode = document.getElementById("metode").value;
      if (!meja) {
        alert("Nomor meja harus diisi!");
        return;
      }
      if (cart.length === 0) {
        alert("Keranjang masih kosong!");
        return;
      }
      const response = await fetch("https://your-railway-app.up.railway.app/order", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ meja, metode, items: cart })
      });

      if (response.ok) {
        alert("Pesanan berhasil dikirim!");
        localStorage.removeItem("cart");
        window.location.href = "index.html";
      } else {
        alert("Gagal mengirim pesanan.");
      }
    }

    // Agar fungsi removeItem bisa diakses dari HTML
    window.removeItem = removeItem;
  </script>
</body>
</html>